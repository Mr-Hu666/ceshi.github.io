(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["serve"],{"076e":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"footer"},[s("ul",{staticClass:"footMsg"},[s("li",{staticClass:"msgList"},[s("span",[t._v(t._s(t.$t("footer.game")))]),s("span",[t._v(t._s(t.$t("footer.system")))])]),s("li",{staticClass:"msgList"},[s("span",[s("router-link",{attrs:{to:"/coin"}},[t._v(t._s(t.$t("home.coin")))])],1),s("span",{staticStyle:{color:"#FFF954"}},[t._v(t._s(t.$t("footer.balance"))+t._s(t.myBalance)+t._s(t.$t("footer.Eth")))])]),s("li",{staticClass:"msgList"},[s("span",[s("router-link",{attrs:{to:"/dice"}},[t._v(t._s(t.$t("home.dice")))])],1),s("span",[s("router-link",{attrs:{to:""}},[t._v(t._s(t.$t("footer.contracts")))])],1)]),s("li",{staticClass:"msgList"},[s("span",[s("router-link",{attrs:{to:"/roulette"}},[t._v(t._s(t.$t("footer.Roulette")))])],1)]),s("li",[t._v(t._s(t.$t("footer.Contact")))]),s("li",{staticClass:"msgList"},[s("router-link",{attrs:{to:""}},[t._v(t._s(t.$t("footer.Email")))])],1),s("li",{staticClass:"msgList"},[s("router-link",{attrs:{to:"/serve"}},[t._v(t._s(t.$t("footer.serve")))])],1)])])},a=[],o=s("8ded"),i={mixins:[o["a"]],data:function(){return{}}},c=i,r=(s("82ad"),s("2877")),u=Object(r["a"])(c,n,a,!1,null,"2b0ea5a0",null);e["a"]=u.exports},"125c":function(t,e,s){"use strict";var n=s("d7d8"),a=s.n(n);a.a},"6b91":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"serve"},[s("h4",[t._v(t._s(t.$t("serve.title")))]),s("section",[s("p",[t._v(t._s(t.$t("serve.serve1")))]),s("p",[t._v(t._s(t.$t("serve.serve2")))]),s("p",[t._v(t._s(t.$t("serve.serve3")))]),s("p",[t._v(t._s(t.$t("serve.serve4")))])]),s("my-footer")],1)},a=[],o=s("076e"),i={components:{myFooter:o["a"]}},c=i,r=(s("125c"),s("2877")),u=Object(r["a"])(c,n,a,!1,null,"a15706ee",null);e["default"]=u.exports},8203:function(t,e,s){},"82ad":function(t,e,s){"use strict";var n=s("8203"),a=s.n(n);a.a},"8ded":function(t,e,s){"use strict";s.d(e,"a",function(){return l});s("6b54"),s("c5f6"),s("96cf");var n,a=s("3b8d"),o=s("e487"),i=s("6314"),c=s.n(i),r=s("81ad"),u=s.n(r),l={data:function(){return{myBalance:"",fees:null,loading:!1,show:!0,isAddress:!1,userAddress:"",userInfo:{},commit:"0x",hash:"",commitLastBlock:"",sha3BetBlock:"",sha3Secret:"",R:"",V:"",S:"",resultInfo:{},comfirmsOne:BigInt("0x0000000000002000000000100000000008000000000400000000020000000001"),comfirmsTwo:BigInt("0x0001041041041041041041041041041041041041041041041041041041041041"),comfirmsThree:BigInt("0x3f"),contractAddress:"0xa29d86c94d8a2025349a7ee2fc23eccd11b005b2",contractAbi:[{constant:!1,inputs:[{name:"betMask",type:"uint256"},{name:"modulo",type:"uint256"},{name:"commitLastBlock",type:"uint256"},{name:"commit",type:"uint256"},{name:"r",type:"bytes32"},{name:"s",type:"bytes32"},{name:"v",type:"uint8"}],name:"placeBet",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[],name:"kill",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"secretSigner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"jackpotSize",outputs:[{name:"",type:"uint128"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"croupier",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_betFee",type:"uint256"}],name:"setBetFee",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"reveal",type:"uint256"},{name:"canonicalBlockNumber",type:"uint40"}],name:"settleBetUncleMerkleProof",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"betFee",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"maxProfit",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"beneficiary",type:"address"},{name:"withdrawAmount",type:"uint256"}],name:"withdrawFunds",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"reveal",type:"uint256"},{name:"blockHash",type:"bytes32"}],name:"settleBet",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"acceptNextOwner",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_nextOwner",type:"address"}],name:"approveNextOwner",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"increaseAmount",type:"uint256"}],name:"increaseJackpot",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"newSecretSigner",type:"address"}],name:"setSecretSigner",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"lockedInBets",outputs:[{name:"",type:"uint128"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"commit",type:"uint256"}],name:"refundBet",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"newCroupier",type:"address"}],name:"setCroupier",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_maxProfit",type:"uint256"}],name:"setMaxProfit",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"beneficiary",type:"address"},{indexed:!1,name:"amount",type:"uint256"},{indexed:!1,name:"commit",type:"uint256"}],name:"FailedPayment",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"beneficiary",type:"address"},{indexed:!1,name:"amount",type:"uint256"},{indexed:!1,name:"commit",type:"uint256"}],name:"Payment",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"beneficiary",type:"address"},{indexed:!1,name:"amount",type:"uint256"},{indexed:!1,name:"commit",type:"uint256"}],name:"JackpotPayment",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"commit",type:"uint256"}],name:"Commit",type:"event"}]}},created:function(){this.IsDapp()},methods:{IsDapp:function(){var t=this;this.$nextTick(function(){Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!window.ethereum){e.next=16;break}return window.web3=new c.a(ethereum),n=new web3.eth.Contract(t.contractAbi,t.contractAddress),t.getAddress(),t.getFees(),e.prev=5,e.next=8,ethereum.enable();case 8:e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](5),t.$Message.error(t.$t("home.denied")),console.log(e.t0);case 14:e.next=17;break;case 16:window.web3?(window.web3=new c.a(web3.currentProvider),n=new web3.eth.Contract(t.contractAbi,t.contractAddress),t.getAddress()):t.$Message.error(t.$t("home.notDapp"));case 17:case"end":return e.stop()}},e,null,[[5,10]])}))()})},getAddress:function(){var t=this;web3.eth.getAccounts().then(function(e){console.log("当前地址：",e[0]),t.userAddress=e[0],t.getBalance(e[0]),t.userAddress&&t.signIn()})},getFees:function(){var t=this;n.methods.betFee().call({from:this.userAddress}).then(function(e){console.log("fee当前值(%)：",e),t.fees=e/100})},getBalance:function(t){var e=this;web3.eth.getBalance(t).then(function(t){e.myBalance=web3.utils.fromWei(t,"ether"),console.log("当前余额：",e.myBalance),e.myBalance=Number(e.myBalance).toFixed(2)})},signIn:function(){var t=this;this.$http.form("/uc/user/sign",{address:this.userAddress}).then(function(e){0==e.code?(t.userInfo=e.data,console.log(t.userInfo),t.isAddress=!0,o["a"].set("Useraddress",t.userInfo.address)):(t.isAddress=!1,t.$Message.error(e.message))})},getCommit:function(){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e=0;e<62;e++){var s=Math.floor(16*Math.random());this.commit+=t[s]}console.log("64位的16进制随机数",this.commit),this.sha3Secret="0x"+u.a.soliditySHA3(["uint256"],[this.commit]).toString("hex"),console.log("sha3随机数",this.sha3Secret),this.sha3Secret&&this.getBlock()},getBlock:function(){var t=this;web3.eth.getBlockNumber().then(function(e){console.log("blockNumber信息：",e),t.commitLastBlock=web3.utils.toHex(Number(e)+256),console.log("commitLastBlock信息：",t.commitLastBlock),t.sha3BetBlock="0x"+u.a.soliditySHA3(["uint256"],[t.commitLastBlock]).toString("hex"),console.log("sha3下注交易块高度",t.sha3BetBlock),t.commitLastBlock&&t.getSign()}).catch(function(t){console.log(t)})},getSign:function(){var t=this;this.hash="0x"+u.a.soliditySHA3(["uint40","uint256"],[this.commitLastBlock,this.sha3Secret]).toString("hex"),console.log("hash:",this.hash),this.$http.form("/uc/bet/getSign",{hash:this.hash}).then(function(e){if(0==e.code){console.log(e);var s=e.data;t.R=s.substr(0,66),t.S="0x"+s.substr(66,64),t.V="0x"+s.slice(-2)}else t.$Message.error(e.message)})},saveBetInfo:function(t,e){var s=this;this.loading=!0;var n="0x"+u.a.soliditySHA3(["uint40"],[t.type]).toString("hex");this.$http.post("uc/bet/saveBetParam",{betAmount:t.value,betBlock:this.commitLastBlock,betHash:this.hash,betMask:t.betMask,bytes32R:this.R,bytes32S:this.S,modulo:t.type,secret:this.commit,sha3BetBlock:this.sha3BetBlock,sha3Mod2:n,sha3Secret:this.sha3Secret,userAddress:this.userInfo.address,userName:this.userInfo.userName}).then(function(n){if(0==n.code){var a=n.data.id;s.placeBet(a,t,e)}else s.$Message.error(n.message),s.loading=!1})},placeBet:function(t,e,s){var n=this,a=new web3.eth.Contract(this.contractAbi,this.contractAddress);console.log("打印传来的id",t),console.log("打印传来的betInfo",e),console.log("传给合约的下注内容16进制",s);var o=web3.utils.toWei(e.value.toString(),"ether");console.log("游戏类型",e.type),console.log("块高度",this.commitLastBlock),console.log("sha3Secret",this.sha3Secret),console.log("R",this.R),console.log("S",this.S),console.log("V",this.V),a.methods.placeBet(s,e.type,this.commitLastBlock,this.sha3Secret,this.R,this.S,this.V).send({from:this.userInfo.address,value:o}).then(function(e){console.log("合约下注placeBet结果：",e),e&&n.saveBetResult(t,e)}).catch(function(s){console.log(s),n.loading=!1,n.$router.push({name:"bet",params:{id:t,type:e.type}})})},saveBetResult:function(t,e){var s=this;console.log("支付后传来的res",e),this.sha3BlkSecret="0x"+u.a.soliditySHA3(["uint256","bytes32"],[this.commit,e.blockHash]).toString("hex"),console.log("开奖需要用到的参数",this.sha3BlkSecret),this.$http.post("uc/bet/saveBetResult",{betBlock:e.blockNumber,betBlockHash:e.blockHash,betHash:e.transactionHash,sha3Secret:this.sha3Secret,sha3BlkSecret:this.sha3BlkSecret}).then(function(e){if(0==e.code){s.loading=!1;var n=e.data.modulo;s.$router.push({name:"bet",params:{id:t,type:n}})}else s.loading=!1,s.$Message.error(e.message)})}}}},d7d8:function(t,e,s){}}]);